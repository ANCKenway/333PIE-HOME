<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>333HOME - Domotique Pro v7.1</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js avec plugin Collapse -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [x-cloak]{display:none!important}
        *{scrollbar-width:thin;scrollbar-color:rgba(156,163,175,0.5) transparent}
        *::-webkit-scrollbar{width:6px;height:6px}
        *::-webkit-scrollbar-track{background:transparent}
        *::-webkit-scrollbar-thumb{background:rgba(156,163,175,0.5);border-radius:3px}
        *::-webkit-scrollbar-thumb:hover{background:rgba(107,114,128,0.7)}
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans antialiased" x-data="app()" x-init="init()">
    
    <!-- Navigation Top Bar -->
    <nav class="bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center text-2xl">üè†</div>
                    <div>
                        <h1 class="text-xl font-bold">333HOME</h1>
                        <p class="text-xs text-purple-200">Domotique Pro v7.0</p>
                    </div>
                </div>
                
                <div class="hidden md:flex space-x-1">
                    <template x-for="t in tabs" :key="t.id">
                        <button @click="tab=t.id" :class="tab===t.id?'bg-white/20 font-semibold':'hover:bg-white/10'" class="px-4 py-2 rounded-lg transition-all text-sm flex items-center space-x-2">
                            <span x-text="t.icon"></span>
                            <span x-text="t.name"></span>
                        </button>
                    </template>
                </div>
                
                <div class="flex items-center space-x-3">
                    <span class="hidden sm:flex items-center space-x-2 bg-white/20 px-3 py-1 rounded-full text-sm">
                        <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                        <span x-text="stats.online+' online'"></span>
                    </span>
                    <button @click="refreshAll()" class="p-2 hover:bg-white/10 rounded-lg transition-all" title="Actualiser">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div class="md:hidden border-t border-white/10">
            <div class="flex overflow-x-auto px-2 py-2 space-x-1">
                <template x-for="t in tabs" :key="t.id">
                    <button @click="tab=t.id" :class="tab===t.id?'bg-white/20 font-semibold':'hover:bg-white/10'" class="px-3 py-1 rounded-lg whitespace-nowrap text-sm flex items-center space-x-1">
                        <span x-text="t.icon"></span>
                        <span x-text="t.name"></span>
                    </button>
                </template>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        
        <!-- TAB: Dashboard -->
        <div x-show="tab==='dashboard'" x-cloak class="space-y-6">
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">üìä Dashboard</h2>
                    <p class="text-sm text-gray-600">Vue d'ensemble du syst√®me ‚Ä¢ <span x-text="lastUpdate"></span></p>
                </div>
            </div>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-2 lg:grid-cols-5 gap-4">
                <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Total Devices</p>
                            <p class="text-3xl font-bold text-gray-900" x-text="stats.total||0"></p>
                        </div>
                        <div class="text-4xl">üì±</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-5 border border-green-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">En Ligne</p>
                            <p class="text-3xl font-bold text-green-600" x-text="stats.online||0"></p>
                        </div>
                        <div class="text-4xl">‚úÖ</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-5 border border-red-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Hors Ligne</p>
                            <p class="text-3xl font-bold text-red-600" x-text="stats.offline||0"></p>
                        </div>
                        <div class="text-4xl">‚ùå</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-5 border border-blue-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">G√©r√©s</p>
                            <p class="text-3xl font-bold text-blue-600" x-text="stats.managed||0"></p>
                        </div>
                        <div class="text-4xl">üéØ</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-5 border border-purple-200 cursor-pointer hover:shadow-lg transition-all" @click="tab='agents'">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Agents</p>
                            <p class="text-3xl font-bold text-purple-600" x-text="agents.length||0"></p>
                        </div>
                        <div class="text-4xl">ü§ñ</div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- System Health -->
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">üè† √âtat Syst√®me</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg border border-green-200">
                            <span class="text-sm font-medium text-gray-700">Serveur 333HOME</span>
                            <span class="px-3 py-1 bg-green-600 text-white rounded-full text-xs font-semibold">‚úÖ Online</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <span class="text-sm font-medium text-gray-700">üîÑ Monitoring temps r√©el</span>
                            <span class="px-3 py-1 bg-blue-600 text-white rounded-full text-xs font-semibold" x-text="'Cycle: 5s'"></span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="text-sm font-medium text-gray-700">Derni√®re mise √† jour</span>
                            <span class="px-3 py-1 bg-gray-200 text-gray-800 rounded-full text-xs font-mono" x-text="lastUpdate || 'Chargement...'"></span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="text-sm font-medium text-gray-700">Version</span>
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-semibold">v7.0 Pro</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="text-sm font-medium text-gray-700">Backend API</span>
                            <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-semibold">‚úÖ OK</span>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">‚ö° Actions Rapides</h3>
                    <div class="space-y-3">
                        <button @click="tab='scanner'" class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-emerald-50 hover:from-green-100 hover:to-emerald-100 border border-green-200 rounded-lg transition-all">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">üîç</span>
                                <div class="text-left">
                                    <p class="font-semibold text-gray-900">Scanner R√©seau</p>
                                    <p class="text-xs text-gray-600">D√©couvrir les appareils</p>
                                </div>
                            </div>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                        <button @click="tab='managed'" class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-pink-50 hover:from-purple-100 hover:to-pink-100 border border-purple-200 rounded-lg transition-all">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">üì±</span>
                                <div class="text-left">
                                    <p class="font-semibold text-gray-900">G√©rer Appareils</p>
                                    <p class="text-xs text-gray-600" x-text="stats.managed+' appareil(s) g√©r√©(s)'"></p>
                                </div>
                            </div>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                        <button @click="exportAllData()" class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-cyan-50 hover:from-blue-100 hover:to-cyan-100 border border-blue-200 rounded-lg transition-all">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">üì•</span>
                                <div class="text-left">
                                    <p class="font-semibold text-gray-900">Exporter Donn√©es</p>
                                    <p class="text-xs text-gray-600">Backup JSON complet</p>
                                </div>
                            </div>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TAB: Managed Devices -->
        <div x-show="tab==='managed'" x-cloak class="space-y-6">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">üì± Appareils G√©r√©s</h2>
                    <p class="text-sm text-gray-600"><span x-text="managedDevices().length"></span> appareil(s) sous gestion</p>
                </div>
                <div class="flex gap-2">
                    <button @click="showAddModal=true" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-all flex items-center space-x-2">
                        <span>‚ûï</span>
                        <span>Ajouter</span>
                    </button>
                    <button @click="loadUnifiedDevices()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all flex items-center space-x-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                        <span>Actualiser</span>
                    </button>
                </div>
            </div>
            
            <div x-show="loading" class="bg-white rounded-xl shadow-sm p-12 text-center border border-gray-200">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-purple-600 border-t-transparent"></div>
                <p class="mt-4 text-gray-600">Chargement...</p>
            </div>
            
            <div x-show="!loading && managedDevices().length===0" class="bg-white rounded-xl shadow-sm p-12 text-center border border-gray-200">
                <div class="text-6xl mb-4">üì±</div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Aucun appareil g√©r√©</h3>
                <p class="text-gray-600 mb-6">Scannez votre r√©seau pour d√©couvrir des appareils ou ajoutez-en manuellement</p>
                <div class="flex gap-3 justify-center">
                    <button @click="tab='scanner'" class="px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-lg transition-all font-semibold">
                        üåê Scanner le R√©seau
                    </button>
                    <button @click="showAddModal=true" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white rounded-lg transition-all font-semibold">
                        ‚ûï Ajouter Manuellement
                    </button>
                </div>
            </div>
            
            <div x-show="!loading && managedDevices().length>0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <template x-for="d in managedDevices()" :key="d.ip||d.current_ip">
                    <div class="bg-white rounded-xl shadow-sm p-5 border border-gray-200 hover:shadow-md transition-all">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1 flex-wrap">
                                    <h3 class="font-semibold text-gray-900" x-text="getDeviceTitle(d)"></h3>
                                    <!-- VPN Badge: Vert si connect√©, Gris si attendu mais d√©connect√© -->
                                    <span x-show="d.is_vpn_connected" class="px-2 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-800">üîí VPN</span>
                                    <span x-show="!d.is_vpn_connected && d.in_devices && (d.metadata?.expect_vpn || d.metadata?.is_vpn || d.tags?.includes('vpn'))" 
                                          class="px-2 py-1 rounded-full text-xs font-semibold bg-gray-200 text-gray-500 opacity-75" 
                                          title="VPN d√©connect√©">üîì VPN</span>
                                    <!-- Agent Badge: Violet si connect√©, Gris si attendu mais d√©connect√© -->
                                    <span x-show="d.is_agent_connected" class="px-2 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-800" :title="'Agent: '+(d.agent_id||'N/A')+' v'+(d.agent_version||'?')">ü§ñ Agent</span>
                                    <span x-show="!d.is_agent_connected && d.in_devices && (d.metadata?.expect_agent || d.tags?.includes('agent') || d.tags?.includes('windows') || d.tags?.includes('pc'))" 
                                          class="px-2 py-1 rounded-full text-xs font-semibold bg-gray-200 text-gray-500 opacity-75" 
                                          title="Agent d√©connect√©">ü§ñ Agent</span>
                                </div>
                                <p class="text-sm text-gray-600 font-mono" x-text="d.ip||d.current_ip"></p>
                                <p x-show="d.is_vpn_connected && d.vpn_ip" class="text-xs text-emerald-600 font-mono" x-text="'VPN: '+d.vpn_ip"></p>
                                <p x-show="d.is_agent_connected && d.agent_id" class="text-xs text-purple-600" x-text="'Agent: '+d.agent_id+' v'+(d.agent_version||'?')"></p>
                                <p x-show="!d.is_vpn_connected && d.in_devices && (d.metadata?.expect_vpn || d.metadata?.is_vpn || d.tags?.includes('vpn'))" 
                                   class="text-xs text-gray-500">‚ö†Ô∏è VPN d√©connect√©</p>
                                <p x-show="!d.is_agent_connected && d.in_devices && (d.metadata?.expect_agent || d.tags?.includes('agent') || d.tags?.includes('windows') || d.tags?.includes('pc'))" 
                                   class="text-xs text-gray-500">‚ö†Ô∏è Agent d√©connect√©</p>
                            </div>
                            <span :class="(d.status==='online'||d.currently_online)?'bg-green-100 text-green-800':'bg-red-100 text-red-800'" class="px-2 py-1 rounded-full text-xs font-semibold" x-text="(d.status==='online'||d.currently_online)?'‚úÖ':'‚ùå'"></span>
                        </div>
                        
                        <div class="space-y-2 mb-4 text-xs">
                            <div x-show="d.mac" class="flex justify-between">
                                <span class="text-gray-600">MAC:</span>
                                <span class="text-gray-900 font-mono text-xs" x-text="d.mac"></span>
                            </div>
                            <div x-show="d.type||d.device_type" class="flex justify-between">
                                <span class="text-gray-600">Type:</span>
                                <span class="text-gray-900" x-text="d.type||d.device_type"></span>
                            </div>
                            <div x-show="d.manufacturer||d.vendor" class="flex justify-between">
                                <span class="text-gray-600">Fabricant:</span>
                                <span class="text-gray-900" x-text="d.manufacturer||d.vendor"></span>
                            </div>
                            <div x-show="d.last_seen" class="flex justify-between">
                                <span class="text-gray-600">Vu:</span>
                                <span class="text-gray-900" x-text="formatTime(d.last_seen)"></span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-4 gap-2">
                            <button @click="wakeDevice(d)" x-show="d.mac && !(d.status==='online'||d.currently_online)" class="px-3 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg text-sm font-medium transition-all" title="Wake-on-LAN">‚ö°</button>
                            <button @click="editDevice(d)" class="px-3 py-2 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg text-sm font-medium transition-all" title="Modifier">‚úèÔ∏è</button>
                            <button @click="viewHistory(d)" class="px-3 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg text-sm font-medium transition-all" title="Historique">üìä</button>
                            <button @click="removeDevice(d)" class="px-3 py-2 bg-red-50 hover:bg-red-100 text-red-700 rounded-lg text-sm font-medium transition-all" title="Retirer">üóëÔ∏è</button>
                        </div>
                    </div>
                </template>
            </div>
        </div>
        
        <!-- TAB: Scanner -->
        <div x-show="tab==='network'" x-cloak class="space-y-6">
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">üåê R√©seau Local</h2>
                    <p class="text-sm text-gray-600">Vue d'ensemble et cartographie du r√©seau</p>
                </div>
                <button @click="showScanPanel=!showScanPanel" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white rounded-lg transition-all text-sm font-medium flex items-center space-x-2">
                    <span>üîç</span>
                    <span x-text="showScanPanel?'Masquer scan':'Nouveau scan'"></span>
                </button>
            </div>
            
            <!-- Panel Scan (masqu√© par d√©faut) -->
            <div x-show="showScanPanel" x-collapse class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">üîç Scanner le r√©seau</h3>
                <div class="max-w-md mx-auto">
                    <button @click="startScan('full')" :disabled="scanning" class="w-full p-6 bg-gradient-to-br from-purple-50 to-pink-50 hover:from-purple-100 hover:to-pink-100 rounded-xl border-2 border-purple-200 text-left transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-sm hover:shadow-md">
                        <div class="flex items-start justify-between mb-3">
                            <div class="text-4xl">üîç</div>
                            <span class="px-3 py-1 bg-purple-600 text-white rounded-full text-xs font-semibold">Scan Complet</span>
                        </div>
                        <h4 class="font-bold text-gray-900 mb-2">Enrichir le monitoring r√©seau</h4>
                        <ul class="text-sm text-gray-600 space-y-1 mb-3">
                            <li>‚úÖ D√©tection multi-sources (nmap + ARP + mDNS + NetBIOS)</li>
                            <li>‚úÖ Vendor, OS, services d√©taill√©s</li>
                            <li>‚úÖ Enrichissement du registry (historique IP/hostname)</li>
                            <li>‚úÖ D√©tection changements DHCP</li>
                            <li>‚è±Ô∏è Dur√©e: ~15-20 secondes</li>
                        </ul>
                        <p class="text-xs text-purple-600 font-medium">üíæ Les donn√©es enrichissent le suivi persistant des devices</p>
                    </button>
                </div>
            </div>
            
            <div x-show="scanning" class="bg-white rounded-xl shadow-sm p-12 text-center border border-gray-200">
                <div class="inline-block animate-spin rounded-full h-16 w-16 border-4 border-purple-600 border-t-transparent mb-4"></div>
                <p class="text-xl font-semibold text-gray-900 mb-2">Scan en cours...</p>
                <p class="text-gray-600 mb-4" x-text="'Type: '+scanType+' ‚Ä¢ Merci de patienter'"></p>
                <div class="max-w-md mx-auto bg-gray-200 rounded-full h-2">
                    <div class="bg-purple-600 h-2 rounded-full animate-pulse" style="width:75%"></div>
                </div>
            </div>
            
            <div x-show="!scanning && scanResults.length>0" class="bg-white rounded-xl shadow-sm border border-gray-200">
                <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">R√©sultats du scan</h3>
                        <p class="text-sm text-gray-600"><span x-text="scanResults.length"></span> appareil(s) d√©tect√©(s) ‚Ä¢ Type: <span x-text="scanType"></span></p>
                    </div>
                    <button @click="confirmResetRegistry()" class="px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-all text-sm font-medium">
                        üóëÔ∏è Reset Registry
                    </button>
                </div>
                <div class="divide-y divide-gray-200 max-h-[600px] overflow-y-auto">
                    <template x-for="(d,i) in scanResults" :key="i">
                        <div class="p-4 hover:bg-gray-50 transition-colors">
                            <div class="flex items-start justify-between">
                                <div class="flex-1 space-y-2">
                                    <div class="flex items-center gap-3 flex-wrap">
                                        <div class="flex items-baseline gap-2">
                                            <h4 class="font-semibold text-gray-900" x-text="getDeviceTitle(d)"></h4>
                                            <span x-show="d.current_hostname" class="text-xs text-gray-500" x-text="'('+d.current_ip+')'"></span>
                                        </div>
                                        <span :class="d.currently_online?'bg-green-100 text-green-800':'bg-red-100 text-red-800'" class="px-2 py-1 rounded-full text-xs font-semibold" x-text="d.currently_online?'‚úÖ':'‚ùå'"></span>
                                        <span x-show="d.is_vpn_connected" class="px-2 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-800" :title="'VPN: '+d.vpn_ip">üîí VPN</span>
                                        <span x-show="d.is_agent_connected" class="px-2 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-800" :title="'Agent: '+(d.agent_id||'N/A')+' v'+(d.agent_version||'?')">ü§ñ Agent</span>
                                        <span x-show="d.in_devices" class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-semibold">‚úì G√©r√©</span>
                                    </div>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-1 text-sm">
                                        <div x-show="!d.current_hostname"><span class="text-gray-600">IP:</span> <span class="font-mono text-gray-900" x-text="d.current_ip||d.ip||'N/A'"></span></div>
                                        <div><span class="text-gray-600">MAC:</span> <span class="font-mono text-xs text-gray-900" x-text="d.mac||'N/A'"></span></div>
                                        <div x-show="d.vendor && d.vendor!=='Unknown'"><span class="text-gray-600">Fabricant:</span> <span class="text-gray-900" x-text="d.vendor"></span></div>
                                        <div x-show="d.os_detected && d.os_detected!=='Unknown'"><span class="text-gray-600">OS:</span> <span class="text-gray-900" x-text="d.os_detected"></span></div>
                                        <div x-show="d.is_vpn_connected && d.vpn_ip"><span class="text-gray-600">IP VPN:</span> <span class="font-mono text-emerald-700 font-medium" x-text="d.vpn_ip"></span></div>
                                        <div x-show="d.is_agent_connected && d.agent_id"><span class="text-gray-600">Agent:</span> <span class="font-mono text-purple-700 font-medium" x-text="d.agent_id+' v'+(d.agent_version||'?')"></span></div>
                                        <div x-show="d.services && Array.isArray(d.services) && d.services.length>0" class="col-span-full"><span class="text-gray-600">Services:</span> <span class="text-purple-600 font-medium" x-text="(d.services||[]).map(s=>s.port+'/'+s.service).join(' ‚Ä¢ ')"></span></div>
                                    </div>
                                </div>
                                <button x-show="!d.in_devices" @click="addDeviceToManaged(d)" class="ml-4 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm font-medium transition-all whitespace-nowrap">
                                    ‚ûï G√©rer
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            
            <div x-show="!scanning && scanResults.length===0" class="bg-white rounded-xl shadow-sm p-12 text-center border border-gray-200">
                <div class="text-6xl mb-4">üåê</div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Aucun scan effectu√©</h3>
                <p class="text-gray-600">Lancez un scan pour d√©couvrir les appareils sur votre r√©seau</p>
            </div>
        </div>
        
        <!-- TAB: VPN -->
        <div x-show="tab==='vpn'" x-cloak class="space-y-6">
            <div>
                <h2 class="text-2xl font-bold text-gray-900">üîí VPN Tailscale</h2>
                <p class="text-sm text-gray-600">Gestion du r√©seau priv√© virtuel</p>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-12 text-center border border-gray-200">
                <div class="text-6xl mb-4">üöß</div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Module en d√©veloppement</h3>
                <p class="text-gray-600">Configuration Tailscale VPN √† venir</p>
            </div>
        </div>
        
        <!-- TAB: Agents -->
        <div x-show="tab==='agents'" x-cloak class="space-y-6">
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">ü§ñ Agents de Contr√¥le</h2>
                    <p class="text-sm text-gray-600">Gestion des agents connect√©s ‚Ä¢ <span x-text="agents.length+' agent(s)'"></span></p>
                </div>
                <button @click="refreshAgents()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all font-medium flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    <span>Actualiser</span>
                </button>
            </div>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-xl shadow-sm p-5 border border-green-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Agents Connect√©s</p>
                            <p class="text-3xl font-bold text-green-600" x-text="agents.length||0"></p>
                        </div>
                        <div class="text-4xl">‚úÖ</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-5 border border-blue-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Windows</p>
                            <p class="text-3xl font-bold text-blue-600" x-text="agents.filter(a=>a.os_platform==='windows').length||0"></p>
                        </div>
                        <div class="text-4xl">ü™ü</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-5 border border-purple-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 mb-1">Linux</p>
                            <p class="text-3xl font-bold text-purple-600" x-text="agents.filter(a=>a.os_platform==='linux').length||0"></p>
                        </div>
                        <div class="text-4xl">üêß</div>
                    </div>
                </div>
            </div>
            
            <!-- Agents Table -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Agent</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Version</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">OS</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Plugins</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Seen</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <template x-if="agents.length===0">
                                <tr>
                                    <td colspan="7" class="px-6 py-12 text-center">
                                        <div class="text-5xl mb-3">ü§ñ</div>
                                        <p class="text-gray-600 font-medium">Aucun agent connect√©</p>
                                        <p class="text-sm text-gray-500 mt-2">Installez et lancez un agent sur vos machines distantes</p>
                                    </td>
                                </tr>
                            </template>
                            <template x-for="agent in agents" :key="agent.agent_id">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center space-x-3">
                                            <div class="text-2xl" x-text="agent.os_platform==='windows'?'ü™ü':'üêß'"></div>
                                            <div>
                                                <div class="font-medium text-gray-900" x-text="agent.agent_id"></div>
                                                <div class="text-xs text-gray-500" x-text="agent.hostname||'N/A'"></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            <span class="w-2 h-2 bg-green-400 rounded-full mr-1.5 animate-pulse"></span>
                                            Connected
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="agent.version||'N/A'"></td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800" x-text="agent.os_platform||'N/A'"></span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        <div class="flex items-center space-x-1">
                                            <span x-text="agent.plugins?.length||0"></span>
                                            <span class="text-gray-400">plugins</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="formatLastSeen(agent.last_heartbeat)"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <div class="flex items-center space-x-2">
                                            <button @click="viewAgentLogs(agent.agent_id)" title="View Logs" class="p-1.5 hover:bg-blue-100 text-blue-600 rounded transition-all">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                            </button>
                                            <button @click="restartAgent(agent.agent_id)" title="Restart" class="p-1.5 hover:bg-yellow-100 text-yellow-600 rounded transition-all">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                                            </button>
                                            <button @click="updateAgent(agent.agent_id)" title="Update" class="p-1.5 hover:bg-green-100 text-green-600 rounded transition-all">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                            </button>
                                            <button @click="openLogMeIn(agent.logmein_id)" :disabled="!agent.logmein_id" title="LogMeIn Rescue" :class="agent.logmein_id?'p-1.5 hover:bg-purple-100 text-purple-600 rounded transition-all':'p-1.5 text-gray-300 cursor-not-allowed rounded'">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
    </main>
    
    <!-- Modal: Add Device -->
    <div x-show="showAddModal" x-cloak @click.self="showAddModal=false" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl max-w-md w-full" @click.stop>
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-bold text-gray-900">‚ûï Ajouter un appareil</h3>
                <button @click="showAddModal=false" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Adresse IP *</label>
                    <input x-model="newDevice.ip" type="text" placeholder="192.168.1.100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nom (optionnel)</label>
                    <input x-model="newDevice.name" type="text" placeholder="Mon appareil" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">MAC (optionnel)</label>
                    <input x-model="newDevice.mac" type="text" placeholder="00:11:22:33:44:55" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent">
                </div>
            </div>
            <div class="p-6 border-t border-gray-200 flex gap-3">
                <button @click="showAddModal=false" class="flex-1 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-all font-medium">
                    Annuler
                </button>
                <button @click="addDeviceManual()" class="flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all font-medium">
                    ‚úÖ Ajouter
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Edit Device -->
    <template x-if="showEditModal && editingDevice">
    <div @click.self="showEditModal=false" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl max-w-md w-full" @click.stop>
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-bold text-gray-900" x-text="'‚úèÔ∏è Modifier: '+(editingDevice?.name||'Device')"></h3>
                <button @click="showEditModal=false" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nom</label>
                    <input x-model="editingDevice.name" type="text" placeholder="Mon appareil" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">IP</label>
                    <input x-model="editingDevice.ip" type="text" placeholder="192.168.1.100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">MAC</label>
                    <input x-model="editingDevice.mac" type="text" placeholder="00:11:22:33:44:55" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea x-model="editingDevice.description" placeholder="Description de l'appareil..." rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"></textarea>
                </div>
                
                <!-- Services attendus -->
                <div class="pt-3 border-t border-gray-200">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Services attendus</label>
                    <div class="space-y-3">
                        <!-- VPN Checkbox -->
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" x-model="editingDevice.expect_vpn" class="w-4 h-4 text-emerald-600 border-gray-300 rounded focus:ring-2 focus:ring-emerald-600">
                            <div class="flex items-center gap-2">
                                <span class="text-sm text-gray-700 group-hover:text-gray-900">üîí VPN Tailscale</span>
                                <span x-show="editingDevice.expect_vpn" class="text-xs text-emerald-600">(badge si d√©connect√©)</span>
                            </div>
                        </label>
                        
                        <!-- Agent Checkbox -->
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" x-model="editingDevice.expect_agent" class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-600">
                            <div class="flex items-center gap-2">
                                <span class="text-sm text-gray-700 group-hover:text-gray-900">ü§ñ Agent 333HOME</span>
                                <span x-show="editingDevice.expect_agent" class="text-xs text-purple-600">(badge si d√©connect√©)</span>
                            </div>
                        </label>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">üí° Coch√© automatiquement si d√©tect√©. D√©cochez pour masquer les badges.</p>
                </div>
            </div>
            <div class="p-6 border-t border-gray-200 flex gap-3">
                <button @click="showEditModal=false" class="flex-1 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-all font-medium">
                    Annuler
                </button>
                <button @click="saveDeviceEdit()" class="flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all font-medium">
                    üíæ Enregistrer
                </button>
            </div>
        </div>
    </div>
    </template>
    
    <!-- Modal: History -->
    <template x-if="showHistoryModal && selectedDevice">
    <div @click.self="showHistoryModal=false" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto" @click.stop>
            <div class="p-6 border-b border-gray-200 flex justify-between items-start">
                <div>
                    <h3 class="text-xl font-bold text-gray-900" x-text="'Historique: '+(selectedDevice?.name||selectedDevice?.ip)"></h3>
                    <p class="text-sm text-gray-600" x-text="selectedDevice?.mac"></p>
                </div>
                <button @click="showHistoryModal=false" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-6">
                <div x-show="!selectedDevice?.deviceHistory" class="text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-blue-600 border-t-transparent mb-3"></div>
                    <p class="text-gray-600">Chargement de l'historique...</p>
                </div>
                
                <!-- Erreur: Device non trouv√© dans registry -->
                <div x-show="selectedDevice?.deviceHistory?.not_found" class="text-center py-8">
                    <div class="text-5xl mb-4">üì≠</div>
                    <h4 class="font-semibold text-gray-900 mb-2">Aucune d√©tection r√©seau</h4>
                    <p class="text-gray-600 mb-4">Ce device n'a jamais √©t√© d√©tect√© lors d'un scan r√©seau</p>
                    <div class="bg-blue-50 rounded-lg p-4 text-left max-w-md mx-auto">
                        <p class="text-sm text-gray-700 mb-2"><strong>üí° Pour cr√©er l'historique :</strong></p>
                        <ol class="text-xs text-gray-600 space-y-1 list-decimal list-inside">
                            <li>Allumez l'appareil <span class="font-mono text-xs" x-text="selectedDevice?.name"></span></li>
                            <li>Lancez un scan r√©seau (onglet Scanner)</li>
                            <li>L'historique se construira automatiquement</li>
                        </ol>
                    </div>
                </div>
                
                <!-- Erreur: Pas de MAC -->
                <div x-show="selectedDevice?.deviceHistory?.error === 'no_mac'" class="text-center py-8">
                    <div class="text-5xl mb-4">‚ö†Ô∏è</div>
                    <h4 class="font-semibold text-gray-900 mb-2">Adresse MAC manquante</h4>
                    <p class="text-gray-600">L'historique n√©cessite une adresse MAC configur√©e</p>
                </div>
                
                <div x-show="selectedDevice?.deviceHistory && !selectedDevice.deviceHistory.not_found && !selectedDevice.deviceHistory.error" class="space-y-6">
                    <!-- Statistiques Globales -->
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-blue-50 rounded-lg p-4 text-center">
                            <p class="text-2xl font-bold text-blue-600" x-text="selectedDevice?.deviceHistory?.total_detections||0"></p>
                            <p class="text-xs text-gray-600">D√©tections</p>
                        </div>
                        <div class="bg-green-50 rounded-lg p-4 text-center">
                            <p class="text-xs font-semibold text-green-600" x-text="selectedDevice?.deviceHistory?.first_seen?new Date(selectedDevice.deviceHistory.first_seen).toLocaleString('fr-FR', {day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'}):'N/A'"></p>
                            <p class="text-xs text-gray-600">Premi√®re vue</p>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-4 text-center">
                            <div x-show="selectedDevice?.online || selectedDevice?.currently_online">
                                <p class="text-xs font-semibold text-green-600">‚úÖ En ligne maintenant</p>
                                <p class="text-xs text-gray-500 mt-1" x-show="selectedDevice?.deviceHistory?.last_seen" x-text="'Vu: '+new Date(selectedDevice.deviceHistory.last_seen).toLocaleString('fr-FR', {day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'})"></p>
                            </div>
                            <div x-show="!(selectedDevice?.online || selectedDevice?.currently_online)">
                                <p class="text-xs font-semibold text-red-600">‚ùå Hors ligne</p>
                                <p class="text-xs text-gray-500 mt-1" x-show="selectedDevice?.deviceHistory?.last_seen" x-text="'Vu: '+new Date(selectedDevice.deviceHistory.last_seen).toLocaleString('fr-FR', {day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'})"></p>
                            </div>
                            <p class="text-xs text-gray-600 mt-1">Statut actuel</p>
                        </div>
                    </div>
                    
                    <!-- Historique IP -->
                    <div x-show="selectedDevice?.deviceHistory?.ip_history?.length>0">
                        <h4 class="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                            <span>üåê Historique IP</span>
                            <span class="text-xs bg-gray-200 px-2 py-1 rounded-full" x-text="selectedDevice?.deviceHistory?.ip_history?.length||0"></span>
                        </h4>
                        <div class="space-y-2">
                            <template x-for="(entry,i) in selectedDevice?.deviceHistory?.ip_history||[]" :key="i">
                                <div class="bg-gray-50 rounded-lg p-3 flex justify-between items-center">
                                    <div>
                                        <p class="font-mono text-sm text-gray-900" x-text="entry.ip"></p>
                                        <p class="text-xs text-gray-600">
                                            <span x-text="new Date(entry.first_seen).toLocaleString('fr-FR')"></span>
                                            <span x-show="entry.last_seen && entry.first_seen !== entry.last_seen">
                                                ‚Üí <span x-text="new Date(entry.last_seen).toLocaleString('fr-FR')"></span>
                                            </span>
                                        </p>
                                    </div>
                                    <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full" x-text="entry.occurrences+' fois'"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Historique Hostname -->
                    <div x-show="selectedDevice?.deviceHistory?.hostname_history?.length>0">
                        <h4 class="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                            <span>üíª Historique Hostname</span>
                            <span class="text-xs bg-gray-200 px-2 py-1 rounded-full" x-text="selectedDevice?.deviceHistory?.hostname_history?.length||0"></span>
                        </h4>
                        <div class="space-y-2">
                            <template x-for="(entry,i) in selectedDevice?.deviceHistory?.hostname_history||[]" :key="i">
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <p class="font-semibold text-sm text-gray-900" x-text="entry.hostname"></p>
                                    <p class="text-xs text-gray-600">
                                        <span x-text="new Date(entry.first_seen).toLocaleString('fr-FR')"></span>
                                        <span x-show="entry.last_seen && entry.first_seen !== entry.last_seen">
                                            ‚Üí <span x-text="new Date(entry.last_seen).toLocaleString('fr-FR')"></span>
                                        </span>
                                    </p>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Aucun historique -->
                    <div x-show="(!selectedDevice?.deviceHistory?.ip_history||selectedDevice.deviceHistory.ip_history.length===0) && (!selectedDevice?.deviceHistory?.hostname_history||selectedDevice.deviceHistory.hostname_history.length===0)" class="text-center py-8">
                        <p class="text-gray-600">Aucun historique de changement enregistr√©</p>
                        <p class="text-xs text-gray-500 mt-2">L'historique se construit au fil des scans r√©seau</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </template>
    
    <!-- Modal: Agent Logs -->
    <div x-show="showLogsModal" x-cloak @click.self="showLogsModal=false" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[80vh] flex flex-col" @click.stop>
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <div>
                    <h3 class="text-xl font-bold text-gray-900" x-text="'üìã Logs: '+currentAgentId"></h3>
                    <p class="text-sm text-gray-600">Logs temps r√©el de l'agent</p>
                </div>
                <div class="flex items-center space-x-2">
                    <button @click="refreshAgentLogs()" class="p-2 hover:bg-gray-100 rounded-lg transition-all" title="Actualiser">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    </button>
                    <button @click="showLogsModal=false" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
            </div>
            <div class="p-6 flex-1 overflow-y-auto bg-gray-900 text-gray-100 font-mono text-sm">
                <div x-show="agentLogs.length===0" class="text-center py-12 text-gray-500">
                    <div class="text-4xl mb-3">üìã</div>
                    <p>Aucun log disponible</p>
                </div>
                <template x-for="log in agentLogs" :key="log.timestamp">
                    <div class="py-1 hover:bg-gray-800 px-2 rounded">
                        <span class="text-gray-500 text-xs" x-text="new Date(log.timestamp).toLocaleTimeString()"></span>
                        <span :class="log.level==='ERROR'?'text-red-400':log.level==='WARNING'?'text-yellow-400':log.level==='INFO'?'text-green-400':'text-blue-400'" class="font-bold ml-2" x-text="'['+log.level+']'"></span>
                        <span class="ml-2" x-text="log.message"></span>
                    </div>
                </template>
            </div>
            <div class="p-4 border-t border-gray-200 bg-gray-50 text-xs text-gray-600 text-center">
                <span x-text="agentLogs.length+' logs affich√©s'"></span> ‚Ä¢ Auto-refresh toutes les 5s
            </div>
        </div>
    </div>
    
    <!-- Modal: Reset Registry Confirmation -->
    <template x-if="showResetModal">
    <div @click.self="showResetModal=false" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl max-w-md w-full" @click.stop>
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-red-600">‚ö†Ô∏è Confirmation Reset Registry</h3>
            </div>
            <div class="p-6 space-y-4">
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <p class="text-sm text-yellow-800 font-medium mb-2">üóëÔ∏è Cette action va :</p>
                    <ul class="text-sm text-yellow-700 list-disc list-inside space-y-1">
                        <li>Cr√©er un backup dans <code class="text-xs bg-yellow-100 px-1 rounded">data/backups/</code></li>
                        <li>Vider compl√®tement le registry r√©seau</li>
                        <li>Effacer l'historique des scans</li>
                        <li>Supprimer tous les doublons et donn√©es anciennes</li>
                    </ul>
                </div>
                <p class="text-sm text-gray-600">üí° <strong>Recommand√©</strong> pour repartir sur une base propre apr√®s accumulation de doublons.</p>
                <p class="text-sm text-gray-600">‚úÖ Le backup sera automatiquement cr√©√© avant le reset.</p>
            </div>
            <div class="p-6 border-t border-gray-200 flex gap-3">
                <button @click="showResetModal=false" class="flex-1 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-all font-medium">
                    Annuler
                </button>
                <button @click="resetRegistry()" class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-all font-medium">
                    üóëÔ∏è Reset Registry
                </button>
            </div>
        </div>
    </div>
    </template>
    
    <!-- Toast Notifications -->
    <div x-show="toast.show" x-cloak class="fixed bottom-4 right-4 z-50 animate-fade-in">
        <div :class="toast.type==='success'?'bg-green-600':toast.type==='error'?'bg-red-600':'bg-blue-600'" class="rounded-lg shadow-lg p-4 text-white max-w-sm">
            <p class="font-medium" x-text="toast.message"></p>
        </div>
    </div>
    
    <script>
    function app(){return{
        tab:'dashboard',
        loading:false,
        scanning:false,
        scanType:'',
        showAddModal:false,
        showEditModal:false,
        editingDevice:null,
        showHistoryModal:false,
        showResetModal:false,
        selectedDevice:null,
        lastUpdate:'',
        toast:{show:false,message:'',type:'success'},
        tabs:[
            {id:'dashboard',name:'Dashboard',icon:'üìä'},
            {id:'managed',name:'Appareils',icon:'üì±'},
            {id:'network',name:'R√©seau',icon:'üåê'},
            {id:'vpn',name:'VPN',icon:'üîí'},
            {id:'agents',name:'Agents',icon:'ü§ñ'}
        ],
        stats:{total:0,online:0,offline:0,managed:0},
        devices:[],
        scanResults:[],
        lastScanTime:null,
        showScanPanel:false,
        newDevice:{ip:'',name:'',mac:''},
        agents:[],
        showLogsModal:false,
        currentAgentId:'',
        agentLogs:[],
        
        managedDevices(){return this.devices.filter(d=>d.managed===true||d.in_devices===true)},
        
        async init(){
            console.log('üöÄ 333HOME v7.0 PRO - Unified');
            await this.loadUnifiedDevices(); // ‚úÖ Source unique
            await this.refreshAgents(); // ‚úÖ Charger agents
            
            // ‚úÖ Refresh registry rapide (5s) en arri√®re-plan pour VPN/Agent status
            setInterval(async ()=>{
                await this.refreshRegistryStatus(); // Refresh ARP + VPN + Agent (< 100ms)
            }, 5000);
            
            // ‚úÖ Reload devices + agents moins fr√©quent (30s) pour √©viter refresh trop rapide UI
            setInterval(async ()=>{
                await this.loadUnifiedDevices();    // Reload devices enrichis
                await this.refreshAgents();         // Refresh agents
                if(this.showLogsModal) await this.refreshAgentLogs(); // Auto-refresh logs si modal ouvert
            }, 30000); // Cycle UI: 30s (confortable pour consultation)
        },
        
        async refreshAll(){
            await this.loadUnifiedDevices();
            this.lastUpdate=new Date().toLocaleTimeString('fr-FR');
        },
        
        async loadUnifiedDevices(){
            // ‚úÖ SOURCE UNIQUE : /api/hub/devices (enrichi depuis registry)
            this.loading=true;
            try{
                const r=await fetch('/api/hub/devices');
                if(!r.ok)throw new Error('Hub devices API error');
                const allDevices = await r.json();
                
                // ‚úÖ Un seul dataset unifi√©
                this.devices = allDevices;
                
                // ‚úÖ Page R√©seau : m√™me source, m√™me format
                this.scanResults = allDevices.map(d => ({
                    mac: d.mac,
                    current_ip: d.ip,
                    ip: d.ip,
                    current_hostname: d.hostname || d.name,
                    hostname: d.hostname || d.name,
                    name: d.hostname || d.name,
                    vendor: d.vendor || 'Unknown',
                    os_detected: d.os_detected,
                    device_type: d.device_type,
                    currently_online: d.online,
                    is_online: d.online,
                    vpn_ip: d.vpn_ip,
                    is_vpn_connected: d.is_vpn_connected || false,
                    is_agent_connected: d.is_agent_connected || false,
                    agent_id: d.agent_id,
                    agent_version: d.agent_version,
                    in_devices: d.in_devices,
                    services: [],
                    last_seen: d.last_seen,
                    first_seen: d.first_seen,
                }));
                
                // ‚úÖ Stats (calcul√©es depuis la m√™me source)
                this.stats = {
                    total: allDevices.length,
                    online: allDevices.filter(d => d.online).length,
                    offline: allDevices.filter(d => !d.online).length,
                    managed: allDevices.filter(d => d.in_devices).length,
                };
                
                this.scanType = 'UNIFIED';
                this.lastScanTime = new Date().toLocaleTimeString('fr-FR');
                this.lastUpdate = new Date().toLocaleTimeString('fr-FR'); // ‚úÖ Timestamp visible dashboard
                
                console.log(`‚úÖ Unified devices: ${allDevices.length} total, ${this.stats.online} online, ${this.stats.managed} managed`);
            }catch(e){
                console.error('LoadUnifiedDevices:',e);
                this.devices=[];
                this.scanResults=[];
            }finally{
                this.loading=false;
            }
        },
        
        async refreshRegistryStatus(){
            // ‚úÖ Refresh l√©ger registry (ARP + VPN status uniquement)
            try{
                const r=await fetch('/api/network/registry/refresh',{method:'POST'});
                if(!r.ok){
                    console.warn('Registry refresh failed:',r.status);
                    return;
                }
                const d=await r.json();
                console.log(`üîÑ Registry refreshed: ${d.online_count} online, ${d.vpn_count} VPN, ${d.updated_count} changes`);
            }catch(e){
                console.error('RefreshRegistry:',e);
            }
        },
        
        async startScan(type){
            this.scanning=true;
            this.scanType=type.toUpperCase();
            this.scanResults=[];
            try{
                const payload={
                    scan_type:type,
                    subnet:"192.168.1.0/24",
                    timeout_ms:type==='full'?5000:2000,
                    scan_ports:type==='full',
                    port_preset:"quick"
                };
                console.log('üåê Starting scan:',payload);
                const r=await fetch('/api/network/scan',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify(payload)
                });
                if(!r.ok){
                    const err=await r.json().catch(()=>({}));
                    throw new Error(err.detail||r.statusText);
                }
                const result=await r.json();
                console.log('‚úÖ Scan result:',result);
                
                // ‚úÖ Recharger depuis source unifi√©e
                await this.refreshRegistryStatus(); // Refresh ARP+VPN
                await this.loadUnifiedDevices(); // Reload tout
                
                this.showToast(`Scan ${type} termin√©: ${this.scanResults.length} appareil(s) d√©tect√©(s)`,'success');
            }catch(e){
                console.error('Scan error:',e);
                this.showToast('Erreur scan: '+e.message,'error');
            }finally{
                this.scanning=false;
            }
        },
        
        async addDeviceManual(){
            if(!this.newDevice.ip){
                this.showToast('IP obligatoire','error');
                return;
            }
            try{
                const payload={
                    ip:this.newDevice.ip,
                    managed:true
                };
                if(this.newDevice.name)payload.name=this.newDevice.name;
                if(this.newDevice.mac)payload.mac=this.newDevice.mac;
                
                const r=await fetch('/api/devices',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify(payload)
                });
                if(!r.ok)throw new Error('Failed to add device');
                await this.loadUnifiedDevices();
                
                this.showToast('Appareil ajout√©','success');
                this.showAddModal=false;
                this.newDevice={ip:'',name:'',mac:''};
            }catch(e){
                console.error('Add device error:',e);
                this.showToast('Erreur: '+e.message,'error');
            }
        },
        
        async addDeviceToManaged(device){
            try{
                const payload={
                    ip:device.current_ip||device.ip,
                    managed:true,
                    name:device.current_hostname||device.hostname||'',
                    mac:device.mac||'',
                    type:device.device_type||device.type||'',
                    manufacturer:device.vendor||device.manufacturer||''
                };
                console.log('‚ûï Adding device:',payload);
                const r=await fetch('/api/devices',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify(payload)
                });
                if(!r.ok)throw new Error('Failed to add device');
                device.in_devices=true;
                await this.loadUnifiedDevices();
                
                this.showToast('Appareil ajout√© √† la gestion','success');
            }catch(e){
                console.error('Add device error:',e);
                this.showToast('Erreur: '+e.message,'error');
            }
        },
        
        editDevice(device){
            // Copier device pour √©dition (√©viter mutation directe)
            this.editingDevice = {
                id: device.id,
                name: device.name || '',
                ip: device.ip || '',
                mac: device.mac || '',
                description: device.description || '',
                // ‚úÖ Services attendus (auto-d√©tection + stock√© dans metadata)
                expect_vpn: device.metadata?.expect_vpn ?? (device.metadata?.is_vpn || device.tags?.includes('vpn') || device.is_vpn_connected || false),
                expect_agent: device.metadata?.expect_agent ?? (device.tags?.includes('agent') || device.tags?.includes('windows') || device.tags?.includes('pc') || device.is_agent_connected || false)
            };
            this.showEditModal = true;
        },
        
        async saveDeviceEdit(){
            if(!this.editingDevice.id){
                this.showToast('Erreur: ID device manquant','error');
                return;
            }
            
            try{
                const payload = {
                    metadata: {} // ‚úÖ Toujours inclure metadata
                };
                if(this.editingDevice.name) payload.name = this.editingDevice.name;
                if(this.editingDevice.ip) payload.ip = this.editingDevice.ip;
                if(this.editingDevice.mac) payload.mac = this.editingDevice.mac;
                if(this.editingDevice.description !== undefined) payload.description = this.editingDevice.description;
                
                // ‚úÖ Sauvegarder services attendus dans metadata
                payload.metadata.expect_vpn = this.editingDevice.expect_vpn || false;
                payload.metadata.expect_agent = this.editingDevice.expect_agent || false;
                
                const r = await fetch(`/api/devices/${this.editingDevice.id}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                
                if(!r.ok) throw new Error('Failed to update device');
                await this.loadUnifiedDevices();
                
                this.showToast('Appareil modifi√© ‚úÖ','success');
                this.showEditModal = false;
                this.editingDevice = null;
            }catch(e){
                console.error('Edit device error:', e);
                this.showToast('Erreur: '+e.message,'error');
            }
        },
        
        async removeDevice(device){
            if(!confirm(`Retirer ${device.name||device.ip} de la gestion?`))return;
            try{
                const r=await fetch(`/api/devices/${device.id}`,{method:'DELETE'});
                if(!r.ok)throw new Error('Failed to remove device');
                await this.loadUnifiedDevices();
                
                this.showToast('Appareil retir√©','success');
            }catch(e){
                console.error('Remove device error:',e);
                this.showToast('Erreur: '+e.message,'error');
            }
        },
        
        async wakeDevice(device){
            if(!device.mac){
                this.showToast('MAC address manquante','error');
                return;
            }
            try{
                const r=await fetch(`/api/devices/${device.id}/wake`,{method:'POST'});
                if(!r.ok)throw new Error('Wake-on-LAN failed');
                this.showToast(`Wake-on-LAN envoy√© √† ${device.name||device.ip}`,'success');
                setTimeout(()=>this.loadUnifiedDevices(),5000);
            }catch(e){
                console.error('Wake error:',e);
                this.showToast('Erreur: '+e.message,'error');
            }
        },
        
        async viewHistory(device){
            this.selectedDevice=device;
            this.showHistoryModal=true;
            
            // Charger historique depuis registry
            if(!device.mac){
                console.warn('Device sans MAC, historique indisponible');
                this.selectedDevice.deviceHistory = { error: 'no_mac' };
                return;
            }
            
            try{
                const r = await fetch(`/api/network/registry/device/${device.mac}`);
                
                if(r.status === 404) {
                    // Device pas encore dans registry (jamais scann√©)
                    console.log(`‚ÑπÔ∏è  Device ${device.name} pas encore dans registry`);
                    this.selectedDevice.deviceHistory = { 
                        not_found: true,
                        mac: device.mac,
                        message: 'Aucune d√©tection r√©seau enregistr√©e'
                    };
                    return;
                }
                
                if(!r.ok) throw new Error('Failed to load history');
                
                const historyData = await r.json();
                this.selectedDevice.deviceHistory = historyData;
                console.log('‚úÖ Device history loaded:', historyData);
            }catch(e){
                console.error('History load error:', e);
                this.selectedDevice.deviceHistory = { error: 'fetch_failed' };
                this.showToast('Erreur chargement historique', 'error');
            }
        },
        
        async exportAllData(){
            try{
                const data={
                    timestamp:new Date().toISOString(),
                    stats:this.stats,
                    devices:this.devices,
                    scanResults:this.scanResults
                };
                const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
                const url=URL.createObjectURL(blob);
                const a=document.createElement('a');
                a.href=url;
                a.download=`333home_backup_${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
                this.showToast('Export r√©ussi','success');
            }catch(e){
                console.error('Export error:',e);
                this.showToast('Erreur export: '+e.message,'error');
            }
        },
        
        getDeviceTitle(d){
            const hostname=d.current_hostname||d.hostname||d.name;
            if(hostname && hostname.trim() && !hostname.includes('192.168') && !hostname.includes('N/A')){
                return hostname.replace('.local','');
            }
            const vendor=d.vendor||d.manufacturer;
            if(vendor && vendor!=='Unknown' && vendor.trim()){
                const ip=d.current_ip||d.ip;
                return`${vendor} ‚Ä¢ ${ip}`;
            }
            const type=d.device_type||d.type;
            if(type && type.trim() && !type.startsWith('‚ùì') && !type.includes('Unknown')){
                const ip=d.current_ip||d.ip;
                return`${type} ‚Ä¢ ${ip}`;
            }
            return d.current_ip||d.ip||d.mac||'Device inconnu';
        },
        
        formatTime(timestamp){
            if(!timestamp)return'N/A';
            try{
                const date=new Date(timestamp);
                return date.toLocaleString('fr-FR',{dateStyle:'short',timeStyle:'short'});
            }catch{return timestamp}
        },
        
        showToast(msg,type='success'){
            this.toast={show:true,message:msg,type};
            setTimeout(()=>this.toast.show=false,4000);
        },
        
        // ============================================
        // ü§ñ AGENTS MANAGEMENT
        // ============================================
        
        async refreshAgents(){
            try{
                const r=await fetch('/api/agents');
                if(!r.ok)throw new Error(`HTTP ${r.status}`);
                const data=await r.json();
                // API retourne directement un array
                this.agents=Array.isArray(data)?data:[];
                console.log(`‚úÖ Agents loaded: ${this.agents.length}`);
            }catch(e){
                console.error('Failed to load agents:',e);
                this.agents=[];
            }
        },
        
        // ============================================
        // üóëÔ∏è REGISTRY RESET
        // ============================================
        
        confirmResetRegistry(){
            this.showResetModal=true;
        },
        
        async resetRegistry(){
            try{
                const r=await fetch('/api/network/registry/reset',{method:'POST'});
                if(!r.ok)throw new Error(`HTTP ${r.status}`);
                const data=await r.json();
                
                this.showToast(`‚úÖ Registry reset - Backup: ${data.timestamp}`,'success');
                this.showResetModal=false;
                
                // Reload tout
                this.scanResults=[];
                await this.loadUnifiedDevices();
                
                console.log(`üóëÔ∏è Registry reset - Backup: ${data.backup_path}`);
            }catch(e){
                console.error('Reset registry error:',e);
                this.showToast('‚ùå Erreur reset registry','error');
            }
        },
        
        async viewAgentLogs(agentId){
            this.currentAgentId=agentId;
            this.agentLogs=[];
            this.showLogsModal=true;
            await this.refreshAgentLogs();
        },
        
        async refreshAgentLogs(){
            if(!this.currentAgentId)return;
            try{
                const r=await fetch(`/api/agents/${this.currentAgentId}/logs?limit=100`);
                if(!r.ok)throw new Error(`HTTP ${r.status}`);
                const data=await r.json();
                this.agentLogs=(data.logs||[]).reverse(); // Plus r√©cents en bas
                console.log(`‚úÖ Logs loaded: ${this.agentLogs.length}`);
            }catch(e){
                console.error('Failed to load logs:',e);
                this.agentLogs=[];
            }
        },
        
        async restartAgent(agentId){
            if(!confirm(`Red√©marrer l'agent ${agentId} ?`))return;
            try{
                const r=await fetch(`/api/agents/${agentId}/tasks`,{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({plugin:'system',action:'restart'})
                });
                if(!r.ok)throw new Error(`HTTP ${r.status}`);
                this.showToast(`Agent ${agentId} red√©marrage demand√©`,'success');
            }catch(e){
                console.error('Restart agent error:',e);
                this.showToast('Erreur restart: '+e.message,'error');
            }
        },
        
        async updateAgent(agentId){
            if(!confirm(`Mettre √† jour l'agent ${agentId} vers la derni√®re version ?`))return;
            try{
                const r=await fetch(`/api/agents/${agentId}/tasks`,{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({plugin:'self_update',params:{}})
                });
                if(!r.ok)throw new Error(`HTTP ${r.status}`);
                this.showToast(`Update lanc√©e pour ${agentId}`,'success');
            }catch(e){
                console.error('Update agent error:',e);
                this.showToast('Erreur update: '+e.message,'error');
            }
        },
        
        openLogMeIn(logmeinId){
            if(!logmeinId){
                this.showToast('LogMeIn ID non configur√©','error');
                return;
            }
            const url=`https://secure.logmeinrescue.com/Customer/Code.aspx?Code=${logmeinId}`;
            window.open(url,'_blank');
            this.showToast('LogMeIn ouvert','success');
        },
        
        formatLastSeen(timestamp){
            if(!timestamp)return'N/A';
            try{
                const now=new Date();
                const date=new Date(timestamp);
                const seconds=Math.floor((now-date)/1000);
                if(seconds<60)return`${seconds}s ago`;
                const minutes=Math.floor(seconds/60);
                if(minutes<60)return`${minutes}m ago`;
                const hours=Math.floor(minutes/60);
                if(hours<24)return`${hours}h ago`;
                return`${Math.floor(hours/24)}j ago`;
            }catch{return'N/A'}
        }
    }}
    </script>
</body>
</html>
