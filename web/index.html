<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>333HOME - Gestion de Parc Informatique</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="/static/main.css">
</head>
<body>
    <div class="app-layout">
        <!-- Menu mobile hamburger -->
        <button class="mobile-menu-btn" id="mobile-menu-btn">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>

        <!-- Overlay mobile -->
        <div class="mobile-overlay" id="mobile-overlay"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>🏠 333HOME</h1>
                <div class="status-indicator" id="status-indicator">⚡ En ligne</div>
            </div>
            
            <nav class="sidebar-nav">
                <button class="nav-btn active" data-tab="status">
                    <span class="nav-icon">📊</span>
                    <span class="nav-text">Statut</span>
                </button>
                <button class="nav-btn" data-tab="devices">
                    <span class="nav-icon">📱</span>
                    <span class="nav-text">Appareils</span>
                </button>
                <button class="nav-btn" data-tab="network">
                    <span class="nav-icon">🌐</span>
                    <span class="nav-text">Scan Réseau</span>
                </button>
                <button class="nav-btn" data-tab="vpn">
                    <span class="nav-icon">🔒</span>
                    <span class="nav-text">VPN Tailscale</span>
                </button>
                <button class="nav-btn" data-tab="test">
                    <span class="nav-icon">🔧</span>
                    <span class="nav-text">Test API</span>
                </button>
            </nav>
        </aside>

        <!-- Contenu principal -->
        <main class="main-content">
            <!-- Tab Statut -->
            <div id="tab-status" class="tab-content active">
                <h2>📊 Statut du Système</h2>
                <div class="status-grid">
                    <div class="card">
                        <h3>🏠 Application</h3>
                        <div id="app-status">Chargement...</div>
                    </div>
                    <div class="card">
                        <h3>📡 Base de Données</h3>
                        <div id="db-status">Chargement...</div>
                    </div>
                </div>
            </div>

            <!-- Tab Appareils -->
            <div id="tab-devices" class="tab-content">
                <div class="page-header">
                    <h2>📱 Appareils Gérés</h2>
                    <p>Appareils ajoutés à votre parc informatique avec fonctionnalités avancées</p>
                </div>
                
                <div class="devices-actions">
                    <button class="btn btn-primary" id="refresh-devices">🔄 Actualiser</button>
                    <button class="btn btn-success" id="add-device">➕ Ajouter Appareil</button>
                    <!-- Bouton Sync VPN supprimé - sync automatique maintenant -->
                </div>
                
                <div class="devices-container">
                    <div id="devices-list">
                        <div class="card">
                            <p class="empty-state">🔍 Aucun appareil géré. Utilisez le scan réseau pour découvrir et ajouter des appareils.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Scan Réseau -->
            <div id="tab-network" class="tab-content">
                <div class="page-header">
                    <h2>🌐 Scan Réseau</h2>
                    <p>Découverte automatique des appareils sur votre réseau local</p>
                </div>
                
                <!-- Informations dernier scan -->
                <div class="scan-info-section">
                    <div class="card">
                        <h3>📊 Informations de Scan</h3>
                        <div id="scan-info-content">
                            <div class="loading">🔄 Chargement des informations...</div>
                        </div>
                    </div>
                </div>
                
                <div class="network-controls">
                    <button class="btn btn-primary" id="start-scan">🔍 Lancer Scan</button>
                    <button class="btn btn-secondary" id="stop-scan" disabled>⏹️ Arrêter</button>
                    <button class="btn btn-outline" id="show-history" onclick="app.toggleNetworkHistory()">📋 Historique Réseau</button>
                    <div class="scan-progress" id="scan-progress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <span id="scan-status">Scan en cours...</span>
                    </div>
                </div>
                
                <!-- Section Historique Réseau -->
                <div class="network-history-section" id="network-history-section" style="display: none;">
                    <div class="card">
                        <h3>📋 Historique des Appareils Réseau</h3>
                        <div class="history-tabs">
                            <button class="tab-btn active" onclick="app.showHistoryTab('devices')">🖥️ Appareils</button>
                            <button class="tab-btn" onclick="app.showHistoryTab('events')">📅 Événements</button>
                        </div>
                        
                        <div id="history-devices" class="history-tab-content active">
                            <div class="loading">🔄 Chargement de l'historique...</div>
                        </div>
                        
                        <div id="history-events" class="history-tab-content" style="display: none;">
                            <div class="loading">🔄 Chargement des événements...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Appareils récemment déconnectés -->
                <div class="disconnected-section" id="disconnected-section" style="display: none;">
                    <div class="card">
                        <h3>📵 Appareils Récemment Déconnectés</h3>
                        <div id="disconnected-devices">
                            <div class="loading">🔄 Chargement...</div>
                        </div>
                    </div>
                </div>
                
                <div class="network-results">
                    <div id="network-devices">
                        <div class="card">
                            <p class="empty-state">🎯 Cliquez sur "Lancer Scan" pour découvrir les appareils réseau</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab VPN Tailscale -->
            <div id="tab-vpn" class="tab-content">
                <div class="page-header">
                    <h2>🔒 VPN Tailscale</h2>
                    <p>Gestion et monitoring de votre réseau Tailscale</p>
                </div>
                
                <div class="vpn-actions">
                    <button class="btn btn-primary" id="refresh-tailscale">🔄 Actualiser</button>
                    <button class="btn btn-secondary" id="tailscale-settings">⚙️ Configuration</button>
                </div>
                
                <!-- Sub-tabs VPN -->
                <div class="vpn-tabs">
                    <button class="vpn-tab active" onclick="app.showVpnTab('devices')">📱 Appareils</button>
                    <button class="vpn-tab" onclick="app.showVpnTab('routes')">🛣️ Routes</button>
                    <button class="vpn-tab" onclick="app.showVpnTab('acl')">🛡️ Sécurité</button>
                </div>
                
                <!-- Tab Appareils -->
                <div id="vpn-tab-devices" class="vpn-tab-content active">
                    <!-- Statistiques VPN -->
                <div class="vpn-stats">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3 id="total-devices">-</h3>
                            <p>Appareils Total</p>
                        </div>
                        <div class="stat-card online">
                            <h3 id="online-devices">-</h3>
                            <p>En Ligne</p>
                        </div>
                        <div class="stat-card offline">
                            <h3 id="offline-devices">-</h3>
                            <p>Hors Ligne</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="last-sync">-</h3>
                            <p>Dernière Synch</p>
                        </div>
                    </div>
                </div>
                
                <!-- Liste des appareils Tailscale -->
                <div class="vpn-devices">
                    <div class="card">
                        <h3>🌐 Appareils Tailscale</h3>
                        <div id="tailscale-devices">
                            <div class="loading">🔄 Chargement des appareils Tailscale...</div>
                        </div>
                    </div>
                </div>
                </div>
                
                <!-- Tab Routes -->
                <div id="vpn-tab-routes" class="vpn-tab-content">
                    <div class="card">
                        <h3>🛣️ Routes Subnet</h3>
                        <p>Configuration des routes pour accéder aux réseaux locaux via Tailscale.</p>
                        <div id="tailscale-routes">
                            <div class="loading">🔄 Chargement des routes...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab ACL/Sécurité -->
                <div id="vpn-tab-acl" class="vpn-tab-content">
                    <div class="card">
                        <h3>🛡️ Contrôle d'Accès (ACL)</h3>
                        <p>Règles de sécurité et politique d'accès du réseau Tailscale.</p>
                        <div id="tailscale-acl">
                            <div class="loading">🔄 Chargement des règles...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Configuration API -->
                <div class="vpn-config" id="vpn-config-section" style="display: none;">
                    <div class="card">
                        <h3>⚙️ Configuration API</h3>
                        <form id="tailscale-config-form">
                            <div class="form-group">
                                <label>🔑 Clé API Tailscale</label>
                                <input type="password" id="tailscale-api-key" class="form-control" 
                                       placeholder="tskey-api-...">
                                <small>Obtenez votre clé sur https://login.tailscale.com/admin/settings/keys</small>
                            </div>
                            <div class="form-group">
                                <label>🏢 Tailnet (Organisation)</label>
                                <input type="text" id="tailscale-tailnet" class="form-control" 
                                       placeholder="tail12345.ts.net ou votre@email.com">
                                <small>Format: tail&lt;hash&gt;.ts.net (visible dans Admin → Settings) ou votre email pour compte personnel</small>
                            </div>
                            <button type="submit" class="btn btn-primary">💾 Sauvegarder</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Tab Test -->
            <div id="tab-test" class="tab-content">
                <h2>🔧 Test API</h2>
                <div class="test-container">
                    <button id="test-get" class="btn">Test GET</button>
                    <button id="test-post" class="btn">Test POST</button>
                    <div id="test-results"></div>
                </div>
            </div>
        </main>

        <!-- Pied de page -->
        <footer class="footer">
            <div class="footer-content">
                <span>333HOME v4.0.0 - Architecture Modulaire</span>
                <span id="connection-status">🟢 Connecté</span>
            </div>
        </footer>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>