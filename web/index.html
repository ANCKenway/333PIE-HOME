<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>333HOME - Gestion de Parc Informatique</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="/static/main.css">
</head>
<body>
    <div class="app-layout">
        <!-- Menu mobile hamburger -->
        <button class="mobile-menu-btn" id="mobile-menu-btn">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>

        <!-- Overlay mobile -->
        <div class="mobile-overlay" id="mobile-overlay"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>ğŸ  333HOME</h1>
                <div class="status-indicator" id="status-indicator">âš¡ En ligne</div>
            </div>
            
            <nav class="sidebar-nav">
                <button class="nav-btn active" data-tab="status">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-text">Statut</span>
                </button>
                <button class="nav-btn" data-tab="devices">
                    <span class="nav-icon">ğŸ“±</span>
                    <span class="nav-text">Appareils</span>
                </button>
                <button class="nav-btn" data-tab="network">
                    <span class="nav-icon">ğŸŒ</span>
                    <span class="nav-text">Scan RÃ©seau</span>
                </button>
                <button class="nav-btn" data-tab="vpn">
                    <span class="nav-icon">ğŸ”’</span>
                    <span class="nav-text">VPN Tailscale</span>
                </button>
                <button class="nav-btn" data-tab="test">
                    <span class="nav-icon">ğŸ”§</span>
                    <span class="nav-text">Test API</span>
                </button>
            </nav>
        </aside>

        <!-- Contenu principal -->
        <main class="main-content">
            <!-- Tab Statut -->
            <div id="tab-status" class="tab-content active">
                <h2>ğŸ“Š Statut du SystÃ¨me</h2>
                <div class="status-grid">
                    <div class="card">
                        <h3>ğŸ  Application</h3>
                        <div id="app-status">Chargement...</div>
                    </div>
                    <div class="card">
                        <h3>ğŸ“¡ Base de DonnÃ©es</h3>
                        <div id="db-status">Chargement...</div>
                    </div>
                </div>
            </div>

            <!-- Tab Appareils -->
            <div id="tab-devices" class="tab-content">
                <div class="page-header">
                    <h2>ğŸ“± Appareils GÃ©rÃ©s</h2>
                    <p>Appareils ajoutÃ©s Ã  votre parc informatique avec fonctionnalitÃ©s avancÃ©es</p>
                </div>
                
                <div class="devices-actions">
                    <button class="btn btn-primary" id="refresh-devices">ğŸ”„ Actualiser</button>
                    <button class="btn btn-success" id="add-device">â• Ajouter Appareil</button>
                    <!-- Bouton Sync VPN supprimÃ© - sync automatique maintenant -->
                </div>
                
                <div class="devices-container">
                    <div id="devices-list">
                        <div class="card">
                            <p class="empty-state">ğŸ” Aucun appareil gÃ©rÃ©. Utilisez le scan rÃ©seau pour dÃ©couvrir et ajouter des appareils.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Scan RÃ©seau -->
            <div id="tab-network" class="tab-content">
                <div class="page-header">
                    <h2>ğŸŒ Scan RÃ©seau</h2>
                    <p>DÃ©couverte automatique des appareils sur votre rÃ©seau local</p>
                </div>
                
                <!-- Informations dernier scan -->
                <div class="scan-info-section">
                    <div class="card">
                        <h3>ğŸ“Š Informations de Scan</h3>
                        <div id="scan-info-content">
                            <div class="loading">ğŸ”„ Chargement des informations...</div>
                        </div>
                    </div>
                </div>
                
                <div class="network-controls">
                    <button class="btn btn-primary" id="start-scan">ğŸ” Lancer Scan</button>
                    <button class="btn btn-secondary" id="stop-scan" disabled>â¹ï¸ ArrÃªter</button>
                    <button class="btn btn-outline" id="show-history" onclick="app.toggleNetworkHistory()">ğŸ“‹ Historique RÃ©seau</button>
                    <div class="scan-progress" id="scan-progress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <span id="scan-status">Scan en cours...</span>
                    </div>
                </div>
                
                <!-- Section Historique RÃ©seau -->
                <div class="network-history-section" id="network-history-section" style="display: none;">
                    <div class="card">
                        <h3>ğŸ“‹ Historique des Appareils RÃ©seau</h3>
                        <div class="history-tabs">
                            <button class="tab-btn active" onclick="app.showHistoryTab('devices')">ğŸ–¥ï¸ Appareils</button>
                            <button class="tab-btn" onclick="app.showHistoryTab('events')">ğŸ“… Ã‰vÃ©nements</button>
                        </div>
                        
                        <div id="history-devices" class="history-tab-content active">
                            <div class="loading">ğŸ”„ Chargement de l'historique...</div>
                        </div>
                        
                        <div id="history-events" class="history-tab-content" style="display: none;">
                            <div class="loading">ğŸ”„ Chargement des Ã©vÃ©nements...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Appareils rÃ©cemment dÃ©connectÃ©s -->
                <div class="disconnected-section" id="disconnected-section" style="display: none;">
                    <div class="card">
                        <h3>ğŸ“µ Appareils RÃ©cemment DÃ©connectÃ©s</h3>
                        <div id="disconnected-devices">
                            <div class="loading">ğŸ”„ Chargement...</div>
                        </div>
                    </div>
                </div>
                
                <div class="network-results">
                    <div id="network-devices">
                        <div class="card">
                            <p class="empty-state">ğŸ¯ Cliquez sur "Lancer Scan" pour dÃ©couvrir les appareils rÃ©seau</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab VPN Tailscale -->
            <div id="tab-vpn" class="tab-content">
                <div class="page-header">
                    <h2>ğŸ”’ VPN Tailscale</h2>
                    <p>Gestion et monitoring de votre rÃ©seau Tailscale</p>
                </div>
                
                <div class="vpn-actions">
                    <button class="btn btn-primary" id="refresh-tailscale">ğŸ”„ Actualiser</button>
                    <button class="btn btn-secondary" id="tailscale-settings">âš™ï¸ Configuration</button>
                </div>
                
                <!-- Sub-tabs VPN -->
                <div class="vpn-tabs">
                    <button class="vpn-tab active" onclick="app.showVpnTab('devices')">ğŸ“± Appareils</button>
                    <button class="vpn-tab" onclick="app.showVpnTab('routes')">ğŸ›£ï¸ Routes</button>
                    <button class="vpn-tab" onclick="app.showVpnTab('acl')">ğŸ›¡ï¸ SÃ©curitÃ©</button>
                </div>
                
                <!-- Tab Appareils -->
                <div id="vpn-tab-devices" class="vpn-tab-content active">
                    <!-- Statistiques VPN -->
                <div class="vpn-stats">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3 id="total-devices">-</h3>
                            <p>Appareils Total</p>
                        </div>
                        <div class="stat-card online">
                            <h3 id="online-devices">-</h3>
                            <p>En Ligne</p>
                        </div>
                        <div class="stat-card offline">
                            <h3 id="offline-devices">-</h3>
                            <p>Hors Ligne</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="last-sync">-</h3>
                            <p>DerniÃ¨re Synch</p>
                        </div>
                    </div>
                </div>
                
                <!-- Liste des appareils Tailscale -->
                <div class="vpn-devices">
                    <div class="card">
                        <h3>ğŸŒ Appareils Tailscale</h3>
                        <div id="tailscale-devices">
                            <div class="loading">ğŸ”„ Chargement des appareils Tailscale...</div>
                        </div>
                    </div>
                </div>
                </div>
                
                <!-- Tab Routes -->
                <div id="vpn-tab-routes" class="vpn-tab-content">
                    <div class="card">
                        <h3>ğŸ›£ï¸ Routes Subnet</h3>
                        <p>Configuration des routes pour accÃ©der aux rÃ©seaux locaux via Tailscale.</p>
                        <div id="tailscale-routes">
                            <div class="loading">ğŸ”„ Chargement des routes...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab ACL/SÃ©curitÃ© -->
                <div id="vpn-tab-acl" class="vpn-tab-content">
                    <div class="card">
                        <h3>ğŸ›¡ï¸ ContrÃ´le d'AccÃ¨s (ACL)</h3>
                        <p>RÃ¨gles de sÃ©curitÃ© et politique d'accÃ¨s du rÃ©seau Tailscale.</p>
                        <div id="tailscale-acl">
                            <div class="loading">ğŸ”„ Chargement des rÃ¨gles...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Configuration API -->
                <div class="vpn-config" id="vpn-config-section" style="display: none;">
                    <div class="card">
                        <h3>âš™ï¸ Configuration API</h3>
                        <form id="tailscale-config-form">
                            <div class="form-group">
                                <label>ğŸ”‘ ClÃ© API Tailscale</label>
                                <input type="password" id="tailscale-api-key" class="form-control" 
                                       placeholder="tskey-api-...">
                                <small>Obtenez votre clÃ© sur https://login.tailscale.com/admin/settings/keys</small>
                            </div>
                            <div class="form-group">
                                <label>ğŸ¢ Tailnet (Organisation)</label>
                                <input type="text" id="tailscale-tailnet" class="form-control" 
                                       placeholder="tail12345.ts.net ou votre@email.com">
                                <small>Format: tail&lt;hash&gt;.ts.net (visible dans Admin â†’ Settings) ou votre email pour compte personnel</small>
                            </div>
                            <button type="submit" class="btn btn-primary">ğŸ’¾ Sauvegarder</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Tab Test -->
            <div id="tab-test" class="tab-content">
                <h2>ğŸ”§ Test API</h2>
                <div class="test-container">
                    <button id="test-get" class="btn">Test GET</button>
                    <button id="test-post" class="btn">Test POST</button>
                    <div id="test-results"></div>
                </div>
            </div>
        </main>

        <!-- Pied de page -->
        <footer class="footer">
            <div class="footer-content">
                <span>333HOME v4.0.0 - Architecture Modulaire</span>
                <span id="connection-status">ğŸŸ¢ ConnectÃ©</span>
            </div>
        </footer>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>